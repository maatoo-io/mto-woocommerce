<?php

use Maatoo\WooCommerce\Entity\MtoUser;
use Maatoo\WooCommerce\Service\LogErrors\LogData;

$mtoUser = new MtoUser();
$logs = LogData::downloadLogLinks();
?>
    <div class="mto-dashboard">
        <svg version="1.1" id="MAATOO" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
             x="0px"
             y="0px" viewBox="0 0 300.5 96.4" style="enable-background:new 0 0 300.5 96.4;" xml:space="preserve">
                                <style type="text/css">
                                    .st0 {
                                        fill: #181716;
                                    }

                                    .st1 {
                                        fill: none;
                                        stroke: #181716;
                                        stroke-width: 1.3;
                                        stroke-linecap: round;
                                        stroke-linejoin: round;
                                    }

                                    .st2 {
                                        fill: none;
                                        stroke: #181716;
                                        stroke-width: 1.3;
                                        stroke-linecap: round;
                                        stroke-linejoin: round;
                                        stroke-miterlimit: 10;
                                    }

                                    .st3 {
                                        fill: none;
                                        stroke: #181716;
                                        stroke-width: 1.3;
                                        stroke-miterlimit: 10;
                                    }

                                    .st4 {
                                        fill: none;
                                        stroke: #181716;
                                        stroke-width: 1.3;
                                    }
                                </style>
            <g>
                <path class="st0"
                      d="M126.8,49.5l10-9.1h2.9V65h-6.5V52.4l-6.4,5.9l-6.5-5.8V65h-6.5V40.4h2.9L126.8,49.5z"></path>
                <path class="st0"
                      d="M145.7,65l11.5-24.6h2.9L171.7,65h-6.5l-1.5-3.2h-10.1l-1.5,3.2H145.7z M156.2,56.4h5l-2.5-5.4L156.2,56.4z"></path>
                <path class="st0"
                      d="M175.7,65l11.5-24.6h2.9L201.7,65h-6.5l-1.5-3.2h-10.1l-1.5,3.2H175.7z M186.2,56.4h5l-2.5-5.4L186.2,56.4z"></path>
                <path class="st0" d="M204.9,40.4h19.4v6.4h-6.5V65h-6.5V46.8h-6.4V40.4z"></path>
                <path class="st0" d="M241.9,40.4c6.8,0,12.3,5.5,12.3,12.3S248.7,65,241.9,65s-12.3-5.5-12.3-12.3S235.1,40.4,241.9,40.4z
                                         M241.9,46.8c-3.2,0-5.8,2.6-5.8,5.9c0,3.2,2.6,5.9,5.8,5.9c3.3,0,5.9-2.7,5.9-5.9C247.8,49.5,245.2,46.8,241.9,46.8z"></path>
                <path class="st0" d="M272.7,40.4c6.8,0,12.3,5.5,12.3,12.3S279.4,65,272.7,65s-12.3-5.5-12.3-12.3S265.9,40.4,272.7,40.4z
                                         M272.7,46.8c-3.2,0-5.8,2.6-5.8,5.9c0,3.2,2.6,5.9,5.8,5.9c3.3,0,5.9-2.7,5.9-5.9C278.5,49.5,275.9,46.8,272.7,46.8z"></path>
            </g>
            <g>
                <g>
                    <polygon class="st1"
                             points="75.6,64.7 88.7,72 91.4,75.3 96.3,76.2 97.9,73.5 94.5,69.8 90.3,69.2 75.6,61.1 		"></polygon>
                    <g>
                        <path class="st2"
                              d="M39.4,45.6c0,0-14.7-9.4-17.1-11c-5.7-3.6-6.2-7.7-6.2-7.7c5.4-1.3,10.2,1.5,10.2,1.5l13.1,8.4V45.6z"></path>
                        <path class="st2" d="M22.3,29.1c1.9,0.3,4.4,2.1,7.4,4.1"></path>
                    </g>
                    <path class="st2" d="M75.6,41.6c0,0,11.6-4.8,12.7-5.2s4.1-1,4.5-0.7c0.4,0.2,1.4,3,1.3,3.3c-0.1,0.4-2.1,2.3-3,2.6s-3-0.7-5-0.3
                                            s-3.7,1.4-3.9,2.9c-0.2,1.4-0.3,1.8,0.1,2.1c0.2,0.2,1-0.1,1.4,0.1c1.6,0.8-0.5,3.5-2.2,2.3c-0.4-0.3-0.6-1.4-1.6-1.1
                                            C79,47.9,79.3,48.7,79,49c-0.6,0.6-3.2,0.2-3.2,0.2v-7.6H75.6z"></path>
                    <path class="st3" d="M75,32.1"></path>
                    <path class="st3" d="M77.6,29"></path>
                    <g>
                        <polygon class="st2" points="75.6,53.2 96.1,57.2 95,63.2 75.6,59.3 			"></polygon>
                        <line class="st2" x1="77.9" y1="55.9" x2="78.3" y2="53.7"></line>
                        <line class="st2" x1="80.4" y1="56.4" x2="80.9" y2="54.2"></line>
                        <line class="st2" x1="83" y1="56.9" x2="83.4" y2="54.7"></line>
                        <line class="st2" x1="85.5" y1="57.4" x2="85.9" y2="55.2"></line>
                        <line class="st2" x1="88.1" y1="58" x2="88.5" y2="55.7"></line>
                        <line class="st2" x1="90.6" y1="58.5" x2="91" y2="56.2"></line>
                        <line class="st2" x1="93.1" y1="59" x2="93.6" y2="56.7"></line>
                    </g>
                    <path class="st2" d="M39.4,68.5L23,80.3c0,0-0.5-3.5,1-7.1l2.8,0.7l0.2-3.2l2.9,0.6l0.2-3.2l2.9,0.6l0.2-3.1l2.9,0.6l0.4-3.7
                                            l3,0.5v5.5H39.4z"></path>
                    <g>
                        <polygon class="st2" points="39.4,51.6 29.5,49.7 30.1,46.7 39.4,48.4 			"></polygon>
                        <line class="st2" x1="32.3" y1="47.1" x2="31.7" y2="50.1"></line>
                        <path class="st2"
                              d="M30.1,46.7c0,0-5.2-5.8-11.1,0c0,0,2.1-0.3,3.5,0.2c1.8,0.6,2.1,5.1,7,2.9"></path>
                    </g>
                    <g>
                        <polygon class="st2"
                                 points="39.4,58.8 26.4,61 21.5,59.2 25.5,55.9 39.4,53.6 			"></polygon>
                        <line class="st2" x1="39.4" y1="56.1" x2="26.5" y2="58.3"></line>
                        <path class="st2" d="M26.4,61c0.7-0.6-0.1-4.7-0.9-5.1"></path>
                    </g>
                    <path class="st2" d="M69.9,34.6c0,0,4.1-4.5,4.7-5.2s1.7-0.3,2.2-0.9c0.5-0.5-0.4-2.1,0.2-2.8c0.6-0.7,2.3,0,2.7-0.5
                                            c0.5-0.6-0.4-2.1,0.2-2.8c0.6-0.7,2.2,0,2.7-0.5c0.5-0.6-0.4-2.1,0.2-2.8c0.7-0.8,2.3,0,2.7-0.5c0.4-0.5-0.9-2.9,0.2-2.4
                                            c1.3,0.5,2.9,2.4,2,3.8c-0.5,0.9-2.2,0.2-2.7,0.8c-0.5,0.6,0.4,2.1-0.2,2.8c-0.6,0.7-2.3,0-2.7,0.5c-0.5,0.6,0.4,2.1-0.2,2.8
                                            s-2.2-0.1-2.7,0.5c-0.5,0.5,0.4,2.1-0.2,2.7s-1.6,0.2-2.3,1s-3.2,3.6-3.2,3.6L69.9,34.6L69.9,34.6z"></path>
                </g>
                <polygon class="st4" points="57.5,48 69.1,34.6 75.6,34.6 75.6,70.8 65.7,70.8 65.7,53.6 57.5,62.2 49.3,53.6 49.3,70.8 39.4,70.8
                                        39.4,34.6 45.9,34.6 	"></polygon>
            </g>
                                </svg>
        <form class="mto-credentials js-mto-credentials">
            <div class="status-bar js-status-bar">
                <?php
                if (MTO_STORE_ID) : ?>
                    <span class="success dashicons-before"><?php
                        _e('Your credentials are valid', 'mto-woocommerce'); ?></span>
                    <div class="sync-info">
                        <div class="sync-info_value dashicons-before">
                            <?php
                            if ($lastFullSync) : ?>
                                <?php
                                printf(
                                  /* translators: %s is replaced with "timestamp of last full sync" */
                                  __('The latest full sync was done %s', 'mto-woocommerce'),
                                  wp_date('m/d/Y H:i:s', strtotime($lastFullSync))
                                ); ?>
                            <?php
                            else:
                                _e(
                                  'The very first synchronization have been scheduled and will be done automatically by WordPress Event manager'
                                );
                            endif; ?>
                        </div>
                    </div>
                <?php
                else : ?>
                    <span class="success hidden dashicons-before"></span>
                <?php
                endif; ?>
                <span class="error hidden dashicons-before"></span>
            </div>
            <label for="url"><?php
                _e('API URL', 'mto-woocommerce'); ?>
                <input type="url" id="url" name="url" value="<?php
                echo $mtoUser->getUrl() ?? ''; ?>" required/>
            </label>
            <label for="login"><?php
                _e('API Token', 'mto-woocommerce'); ?>
                <input type="text" id="login" name="login" value="<?php
                echo $mtoUser->getUsername() ?? ''; ?>" required/>
            </label>

            <label for="password"><?php
                _e('API Key', 'mto-woocommerce'); ?>
                <input type="password" name="password" id="password" value="<?php
                echo $mtoUser->getPassword() ?? ''; ?>" required/>
            </label>
            <label for="marketing">
                <input type="checkbox" name="add_marketing_field" id="marketing" <?php
                echo $mtoUser->isMarketingEnabled() ? 'checked' : ''; ?>/> <?php
                _e('Add marketing opt-in to checkout page', 'mto-woocommerce'); ?>
            </label>
            <label for="birthday">
                <input type="checkbox" name="add_birthday_field" id="birthday" <?php
                echo $mtoUser->isBirthdayEnabled() ? 'checked' : ''; ?>/> <?php
                _e('Add Birthday Field to checkout page', 'mto-woocommerce'); ?>
            </label>
            <input type="submit" name="save" value="<?php
            _e('Update Configuration', 'mto-woocommerce'); ?>">
        </form>
        <?php
        if (MTO_STORE_ID): ?>
            <div class="sync-info-next dashicons-before">
                <?php
                /* translators: %s is replaced with "timestamp of next full sync" */
                printf(__('The next synchronization is scheduled for <br/>%s', 'mto-woocommerce'), $nextEvent); ?>
            </div>
        <?php
        endif;
        if (!empty($logs)) :
            echo $logs;
        endif; ?>
    </div>
<?php
